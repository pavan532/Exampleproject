package com.nit.datajapa.serviceimp;

import java.util.List;
import java.util.stream.Collectors;

import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.nit.datajapa.entity.Task;
import com.nit.datajapa.entity.Users;
import com.nit.datajapa.exception.UserNotFound;
import com.nit.datajapa.payload.TaskDto;
import com.nit.datajapa.repositary.TaskRepositary;
import com.nit.datajapa.repositary.UsersRpositary;
import com.nit.datajapa.service.TaskServices;

@Service
public class TaskServiceimp implements TaskServices{

	@Autowired
	private ModelMapper modelmapper;

	@Autowired
    private UsersRpositary userrepo;
	
	@Autowired
	private TaskRepositary taskrepo;
	
	@Override
	public TaskDto SaveTask(int userid, TaskDto taskdto) {
		Users user=userrepo.findById(userid).orElseThrow(
				()-> new UserNotFound(String.format("User %d Not Found", userid)));	
		Task task = modelmapper.map(taskdto, Task.class);
		task.setUser(user);
		Task tasksaved =taskrepo.save(task);
		return modelmapper.map(tasksaved, TaskDto.class);
	}


   
	@Override
	public List<TaskDto> getAllTasks(int userid) {
		
		userrepo.findById(userid).orElseThrow(
				()-> new UserNotFound(String.format("User %d Not Found", userid)));
		List<Task> tasks=taskrepo.findAllByuserid(userid);
		
		return tasks.stream().map
				( task -> modelmapper.map(task,TaskDto.class)).collect(Collectors.toList());
	}

}
